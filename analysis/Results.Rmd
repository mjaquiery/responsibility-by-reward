---
title: "Results"
author: "Matt Jaquiery"
date: "12/11/2021"
output: word_document
---

```{r setup, include=FALSE}
options(scipen = 10)

knitr::opts_chunk$set(echo = F, include = F)

library(tidyverse)
library(glue)
library(lubridate)
library(ggridges)
library(ez)
library(BayesFactor)
library(magrittr)

# Turn a number into a </= X representation
n2s <- function(n, digits = 4, limit = 10^-digits) 
  if_else(
    n < limit, 
    glue('< {limit}'), 
    glue('= {round(n, digits)}')
  )

# Format t.test output nicely with Cohen's d
tt <- function(df, dv, iv, id = subject_id, ...) {
  # ttest
  tmp <- df %>% 
    select({{dv}}, {{iv}}, {{id}}) %>%
    # Spread
    pivot_wider(names_from = {{iv}}, values_from = {{dv}}) 
  r <- t.test(pull(tmp, 2), pull(tmp, 3), ...)
  # Cohen's d (mean diff / pooled sd)
  d <- df %>%
    group_by({{iv}}) %>%
    summarise(mean = mean({{dv}}), sd = sd({{dv}}), n = n(), .groups = "drop")
  d <- abs(d$mean[1] - d$mean[2]) / 
    ((d$sd[1] * d$n[1] + d$sd[2] * d$n[2]) / sum(d$n))
  # Write result
  glue(
    "_t_({r$parameter}) {n2s(r$statistic, 3)}, _p_ {n2s(r$p.value)}, _d_ {n2s(d, 3)}"
  )
}

```

```{r load raw data}
d <- read.csv('../data/main-data_raw.csv') %>% 
  as_tibble()
```

# Results

```{r descriptive stats}

max_rating_time <- 15000 # 15s
max_missed_trials <- 10
expected_trial_n <- 72 # 3 sets of 2x12 trials
n_participants <- 500

# # double_entry -- taken care of by Prolific
# exclude_ids <- d %>%
#   nest(d = -prolificid) %>%
#   mutate(
#     d = map(d, ~ filter(., subject_id != subject_id[1]))
#   ) %>%
#   unnest(cols = d) %>%
#   select(subject_id) %>% 
#   unique() %>%
#   mutate(double_entry = T)
exclude_ids <- tribble(~ subject_id)

# mark trials that take too long as missed
d <- d %>% 
  mutate(tooLong = time_ratings_end - time_ratings_start > max_rating_time)

# Back up dataframe for keeping a record of lost data
d.old <- d

# max_missed_trials
exclude_ids <- full_join(
  exclude_ids,
  d %>% 
    nest(df = -subject_id) %>%
    mutate(missed_trials = 
             map_dbl(df, . %>% filter(vote_p1 == "" | tooLong) %>% nrow()),
           missed_trials = missed_trials >= max_missed_trials) %>%
    filter(missed_trials) %>%
    select(-df),
  by = "subject_id"
)

# expected_trial_n
exclude_ids <- full_join(
  exclude_ids, 
  d %>%
    filter(label == 'threePlayerGamble') %>%
    nest(df = -subject_id) %>%
    mutate(df = map_dbl(df, nrow)) %>%
    filter(df < expected_trial_n) %>%
    mutate(trial_count = T) %>%
    select(-df),
  by = "subject_id"
  )

# We now remove missed trials
# Whether we do this BEFORE or AFTER checking consecutive responses matters
d <- d %>% filter(vote_p1 != "" & !tooLong)

# Note who we lost entirely while doing this
exclude_ids <- full_join(
  exclude_ids, 
  d.old %>% 
    transmute(subject_id, all_miss = !(subject_id %in% d$subject_id)) %>%
    filter(all_miss) %>%
    unique(),
  by = "subject_id"
)

# max_consec_resp
exclude_ids <- full_join(
  exclude_ids,
  d %>% 
    nest(d = c(-subject_id, -block)) %>%
    mutate(
      consec_resp = map_lgl(d, ~ all(.$vote_p1 == .$vote_p1[1]))
    ) %>%
    filter(consec_resp) %>%
    select(subject_id, consec_resp) %>%
    unique(),
  by = "subject_id"
)

exclude_ids <- full_join(
  exclude_ids,
  d %>% 
    filter(!(subject_id %in% exclude_ids$subject_id)) %>%
    nest(d = -subject_id) %>%
    mutate(first = map_dbl(d, ~ min(as_datetime(.$date)))) %>%
    arrange(first) %>%
    rowid_to_column() %>%
    filter(rowid > n_participants) %>%
    transmute(subject_id, surplus_to_prereg = T),
  by = "subject_id"
)

exclude_ids %>% 
  mutate(total_unique_exclusions = 1) %>% 
  select(everything(), total_unique_exclusions, -subject_id) %>% 
  summarise_all(sum, na.rm = T) %>% 
  pivot_longer(cols = everything(), 
               names_to = 'Reason', 
               values_to = 'N excluded') 
  # apa_table()

d <- d %>% 
  filter(!(subject_id %in% exclude_ids$subject_id)) %>% 
  mutate(
    subject_id = factor(subject_id),
    status = factor(status, labels = c('Participant in majority', 
                                       'Participant in minority')),
    outcome = factor(outcome, labels = c('Reward', 'No reward')),
    getsout = factor(getsout, labels = c('Player 0', 'Participant', 'Player 2')),
    pgetsout = factor(if_else(getsout == "Participant", 1, 2), labels = c(
      'Participant gets outcome', 'Another gets outcome'
    ))
  )

```

`r length(unique(d.old$subject_id))` participants attempted the experiment.
In line with our declared exclusion criteria, we excluded `r nrow(exclude_ids)`, leaving our target sample size of `r length(unique(d$subject_id))` participants for analysis.
We planned to exclude participants where: it was not their first attempt at the experiment (0);
they did not choose a gamble on 10 or more trials (`r sum(exclude_ids$missed_trials, na.rm = T)`);
they did not use both response buttons in choosing gambles in each block (`r sum(exclude_ids$consec_resp, na.rm = T)`); or their data did not include all 72 trials (`r sum(exclude_ids$trial_count, na.rm = T) + sum(exclude_ids$all_miss, na.rm = T)`).
Finally, the last `r sum(exclude_ids$surplus_to_prereg, na.rm = T)` participants were excluded to keep to our preregistered sample size.
The trial count exclusions were calculated before individual trials were removed. 
Individual trials were removed where: 
the participant failed to respond (`r round(d.old %>% filter(is.na(rt), vote_p1 == "") %>% nrow() / d.old %>% filter(is.na(rt)) %>% nrow() * 100, 2)`%); 
or the participant stayed longer than 15 sec on the responsibility rating screen (`r round(d.old %>% filter(is.na(rt), tooLong) %>% nrow() / d.old %>% filter(is.na(rt)) %>% nrow() * 100, 2)`%).
The participants in the sample remaining after exclusions self-reported their mean age as `r round(d %>% pull(age) %>% as.numeric() %>% mean(), 2)` years (_SD_ = `r round(d %>% pull(age) %>% as.numeric() %>% sd(), 2)`; range: `r r = d %>% pull(age) %>% as.numeric() %>% range(); round(r[1], 2)`, `r round(r[2], 2)`). They self-reported their gender with a single character as `r d %>% transmute(gender = str_to_upper(gender), subject_id) %>% group_by(gender, subject_id) %>% summarise(n = n(), .groups = "drop_last") %>% summarise(n = n()) %>% mutate(str = glue("{gender}: {n} ({sprintf('%.2f', round(n / sum(n), 2) * 100)}%)")) %>% pull(str) %>% paste(collapse = ', ')`.

## Responsibility ratings

```{r pivot and figure}

d.long <- d %>% 
  pivot_longer(cols = starts_with('responsibility_rating_p'),
               names_to = 'rated_player',
               values_to = 'responsibility_rating') %>%
  mutate(rated_player = str_extract(rated_player, 'p[0-9]+$'),
         rated_player = case_when(rated_player == 'p0' ~ 'Player 0', 
                                  rated_player == 'p1' ~ 'Participant',
                                  rated_player == 'p2' ~ 'Player 2'),
         is_participant = factor(if_else(rated_player == 'Participant',
                                         'ratingForParticipant',
                                         'ratingForOther')),
         gout = if_else(getsout == 'Participant', 
                        'Participant', as.character(getsout)),
         rated_gets_outcome = str_detect(rated_player, paste0(gout)),
         rated_gets_outcome = factor(if_else(rated_gets_outcome, 
                                             'ratedGetsOutcome',
                                             'otherGetsOutcome')),
         `Outcome recipient` = if_else(
           rated_gets_outcome == "ratedGetsOutcome",
           "Outcome owner", "Not outcome owner"
         ),
         `Outcome valence` = outcome)

dw <- 1

fig <- d.long %>%
  group_by(subject_id, `Outcome valence`, `Outcome recipient`, is_participant) %>% 
  summarise(responsibility_rating = mean(responsibility_rating), .groups = 'drop') %>%
  mutate(
    `Is participant` = if_else(is_participant == "ratingForOther", "Other", "Self")
  ) %>%
  mutate(
    `Outcome recipient` = fct_rev(`Outcome recipient`),
    `Is participant` = fct_rev(`Is participant`)
  ) %>%
  ggplot(aes(x = `Is participant`, y = responsibility_rating, colour = `Outcome valence`)) +
  geom_hline(yintercept = 100 / 3, linetype = 'dashed', size = 3) +
  geom_point(
    alpha = .15, size = 10, 
    position = position_jitterdodge(dw/3, dodge.width = dw)
  ) +
  stat_summary(geom = "col", aes(group = `Outcome valence`), fill = NA, size = 3, 
               fun = mean, position = position_dodge(dw)) +
  stat_summary(geom = "errorbar", aes(group = `Outcome valence`), width = 0, 
               fun.data = mean_cl_normal, position = position_dodge(dw), size = 9) +
  scale_colour_discrete(h.start = 180) +
  guides(colour = guide_legend(override.aes = list(alpha = 1, size = 50))) + 
  scale_y_continuous(limits = c(0, 100), expand = expansion(0, c(2, 5))) +
  facet_wrap(~ `Outcome recipient`) +
  labs(x = "", 
       y = "Participant rating of responsibility") +
  theme(
    legend.position = 'top',
    text = element_text(size = 100),
    panel.grid = element_blank(),
    panel.background = element_blank(),
    strip.background = element_blank()
  )

ggsave(
  './figures/anova.png',
  plot = fig,
  width = 1200, height = 900, 
  units = 'mm', dpi = 300
)

```

```{r figure, fig.cap="Ratings of responsibility by category. Each point is a participant's average. The dashed line indicates 1/3rd, the expected responsibility rating if all three group members were equally responsible for the outcome. Columns show the mean values for each category, with the error bars indicating 95\\% confidence intervals. The transparent bands represent 95\\% confidence intervals of the means collapsed across majority/minority trials."}
knitr::include_graphics('./figures/anova.png')
```

```{r figure split by status}


dw <- 1

tmp <- d.long %>%
  group_by(subject_id, `Outcome valence`, `Outcome recipient`, is_participant) %>% 
  summarise(responsibility_rating = mean(responsibility_rating), .groups = 'drop') %>%
  mutate(
    `Is participant` = if_else(is_participant == "ratingForOther", "Other", "Self")
  ) %>%
  mutate(
    `Outcome recipient` = fct_rev(`Outcome recipient`),
    `Is participant` = fct_rev(`Is participant`)
  ) %>% 
  group_by(`Outcome recipient`, `Outcome valence`, `Is participant`) %>%
  nest(d = c(responsibility_rating, subject_id)) %>%
  mutate(
    rr_ci = map(d, ~ mean_cl_normal(.$responsibility_rating))
  ) %>%
  unnest(cols = rr_ci) %>%
  select(-d)

fig <- d.long %>%
  group_by(subject_id, `Outcome valence`, `Outcome recipient`, is_participant, status) %>% 
  summarise(responsibility_rating = mean(responsibility_rating), .groups = 'drop') %>%
  mutate(
    `Is participant` = if_else(is_participant == "ratingForOther", "Other", "Self")
  ) %>%
  mutate(
    `Outcome recipient` = fct_rev(`Outcome recipient`),
    `Is participant` = fct_rev(`Is participant`)
  ) %>%
  ggplot(aes(x = `Is participant`, y = responsibility_rating, colour = `Outcome valence`)) +
  geom_hline(yintercept = 100 / 3, linetype = 'dashed', size = 3) +
  # geom_col(aes(group = `Outcome valence`, y = y, fill = `Outcome valence`), size = 5, 
  #          position = position_dodge(dw), alpha = .2, colour = NA,
  #          data = tmp) +
  geom_errorbar(aes(group = `Outcome valence`, y = y, ymin = ymin, ymax = ymax), 
                size = 150, position = position_dodge(dw), alpha = .2, width = 0,
                data = tmp) +
  geom_point(
    alpha = .15, size = 10, 
    position = position_jitterdodge(dw/3, dodge.width = dw)
  ) +
  stat_summary(geom = "col", aes(group = `Outcome valence`), fill = NA, size = 3, 
               fun = mean, position = position_dodge(dw)) +
  stat_summary(geom = "errorbar", aes(group = `Outcome valence`), width = 0, 
               fun.data = mean_cl_normal, position = position_dodge(dw), size = 9) +
  scale_colour_discrete(h.start = 180) +
  guides(colour = guide_legend(override.aes = list(alpha = 1, size = 50))) + 
  scale_y_continuous(limits = c(0, 100), expand = expansion(0, c(2, 5))) +
  facet_grid(status ~ `Outcome recipient`) +
  labs(x = "", 
       y = "Participant rating of responsibility") +
  theme(
    legend.position = 'top',
    text = element_text(size = 100),
    panel.grid = element_blank(),
    panel.background = element_blank(),
    strip.background = element_blank()
  )

ggsave(
  './figures/anova_split.png',
  plot = fig,
  width = 1200, height = 900, 
  units = 'mm', dpi = 300
)

```

```{r split figure output, fig.cap="Ratings of responsibility by category. Each point is a participant's average. The dashed line indicates 1/3rd, the expected responsibility rating if all three group members were equally responsible for the outcome. Columns show the mean values for each category, with the error bars indicating 95\\% confidence intervals. The transparent bands represent 95\\% confidence intervals of the means collapsed across majority/minority trials."}
knitr::include_graphics('./figures/anova_split.png')
```

```{r anova and marginal means}

suppressWarnings({
  a <- ezANOVA(
    data = d.long,
    dv = responsibility_rating,
    wid = subject_id,
    within = c(
      outcome,
      rated_gets_outcome,
      is_participant
    ),
    type = 3
  )
})

a <- a$ANOVA %>% 
  mutate(
    str = glue("_F_({DFn}/{DFd}) {n2s(F, 2)}, _p_ {n2s(p)}, _ges_ {n2s(ges, 4)}")
  )

# MARGINAL MEANS

# Outcome ownership main effect
mm.own <- d.long %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.own.self <- d.long %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.own.other <- d.long %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.own.self <- d.long %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(subject_id, rated_gets_outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, rated_gets_outcome, paired = T)
tt.own.other <- d.long %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(subject_id, rated_gets_outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, rated_gets_outcome, paired = T)

mm.own; mm.own.self; tt.own.self; mm.own.other; tt.own.other

# Outcome valence main effect
mm.out <- d.long %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.out.self <- d.long %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.out.other <- d.long %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.out.self <- d.long %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(subject_id, outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, outcome, paired = T)
tt.out.other <- d.long %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(subject_id, outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, outcome, paired = T)

mm.out; mm.out.self; tt.out.self; mm.out.other; tt.out.other

# Outcome valence x Outcome ownership
mm.oo <- d.long %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.oo.self <- d.long %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.oo.other <- d.long %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.oo.self <- d.long %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>%
  tt(diff, rated_gets_outcome, paired = T)
tt.oo.other <- d.long %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>%
  tt(diff, rated_gets_outcome, paired = T)
  
mm.oo; mm.oo.self; tt.oo.self; mm.oo.other; tt.oo.other

# Outcome valence x Outcome ownership x Self
mm.3w <- d.long %>%
  group_by(is_participant, outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "keep") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  summarise(diff = `Reward` - `No reward`, .groups = "drop_last") %>%
  pivot_wider(names_from = rated_gets_outcome, values_from = diff) %>%
  summarise(diff = ratedGetsOutcome - otherGetsOutcome, .groups = "drop") %>%
  group_by(is_participant) %>%
  summarise(m = mean(diff), sd = sd(diff)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))


# Main effect of Self
mm.self <- d.long %>%
  group_by(is_participant, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

```

Participants' responsibility ratings matched the pattern we expected in many respects. 
As expected, there was a main effect of ownership where responsibility ratings were higher for the outcome owner (`r a$str[2]`; Mean responsibility _without_ outcome = `r mm.own$m[1]` (`r mm.own$sd[1]`); Mean responsibility _with_ outcome = `r mm.own$m[2]` (`r mm.own$sd[2]`)).
This effect was present both within Self ratings (Mean responsibility _without_ outcome = `r mm.own.self$m[1]` (`r mm.own.self$sd[1]`); Mean responsibility _with_ outcome = `r mm.own.self$m[2]` (`r mm.own.self$sd[2]`); `r tt.own.self`) and within Other ratings (Mean responsibility _without_ outcome = `r mm.own.other$m[1]` (`r mm.own.other$sd[1]`); Mean responsibility _with_ outcome = `r mm.own.other$m[2]` (`r mm.own.other$sd[2]`); `r tt.own.other`).
We also saw the expected valence bias, with responsibility ratings being higher on trials where the outcome was a reward compared to no reward (Main effect of outcome valence: `r a$str[1]`; Mean responsibility for _no reward_ outcome = `r mm.out$m[2]` (`r mm.out$sd[2]`); Mean responsibility for _reward_ outcome = `r mm.out$m[1]` (`r mm.out$sd[1]`)).
This effect was present both within Self ratings (Mean responsibility for _no reward_ outcome = `r mm.out.self$m[2]` (`r mm.out.self$sd[2]`); Mean responsibility for _reward_ outcome = `r mm.out.self$m[1]` (`r mm.out.self$sd[1]`); `r tt.out.self`) and within Other ratings (Mean responsibility for _no reward_ outcome = `r mm.out.other$m[2]` (`r mm.out.other$sd[2]`); Mean responsibility for _reward_ outcome = `r mm.out.other$m[1]` (`r mm.out.other$sd[1]`); `r tt.out.other`).

In terms of interactions, we expected that valence bias would be stronger when the rated person is the outcome owner, and observed the predicted outcome valence x ownership interaction (`r a$str[4]`; Mean reward benefit _without_ outcome = `r mm.oo$m[1]` (`r mm.oo$sd[1]`); Mean reward benefit _with_ outcome = `r mm.oo$m[2]` (`r mm.oo$sd[2]`)).
We observed this pattern for both Self ratings (Mean reward benefit _without_ outcome = `r mm.oo.self$m[1]` (`r mm.oo.self$sd[1]`); Mean reward benefit _with_ outcome = `r mm.oo.self$m[2]` (`r mm.oo.self$sd[2]`); `r tt.oo.self`) and Other ratings (Mean reward benefit _without_ outcome = `r mm.oo.other$m[1]` (`r mm.oo.other$sd[1]`); Mean reward benefit _with_ outcome = `r mm.oo.other$m[2]` (`r mm.oo.other$sd[2]`); `r tt.oo.self`).
We also found the expected three-way interaction: the difference in reward benefit from receiving the reward was larger for Self ratings than Other ratings (`r a$str[7]`; Mean receive reward benefit for Self = `r mm.3w$m[2]` (`r mm.3w$sd[2]`); Mean receive reward benefit for Other = `r mm.3w$m[1]` (`r mm.3w$sd[1]`)).

We also saw effects for which we had no formal expectations.
Other ratings of responsibility were overall higher than Self ratings (`r a$str[3]`; Mean Self responsibility = `r mm.self$m[2]` (`r mm.self$sd[2]`); Mean Other responsibility = `r mm.self$m[1]` (`r mm.self$sd[1]`)).
The other interactions were all significant, meaning that we saw differences between Self and Other in both outcome ownership bias (`r a$str[6]`) and outcome valence bias (`r a$str[5]`).

### Contextualising results by majority/minority status

```{r anova and marginal means majority}

suppressWarnings({
  a.4way <- ezANOVA(
    data = d.long,
    dv = responsibility_rating,
    wid = subject_id,
    within = c(
      outcome,
      rated_gets_outcome,
      is_participant,
      status
    ),
    type = 3
  )
})

a.4way <- a.4way$ANOVA %>% 
  mutate(
    str = glue("_F_({DFn}/{DFd}) {n2s(F, 2)}, _p_ {n2s(p)}, _ges_ {n2s(ges, 4)}")
  )

d.maj <- d.long %>% filter(status == "Participant in majority")

suppressWarnings({
  a.maj <- ezANOVA(
    data = d.maj,
    dv = responsibility_rating,
    wid = subject_id,
    within = c(
      outcome,
      rated_gets_outcome,
      is_participant
    ),
    type = 3
  )
})

a.maj <- a.maj$ANOVA %>% 
  mutate(
    str = glue("_F_({DFn}/{DFd}) {n2s(F, 2)}, _p_ {n2s(p)}, _ges_ {n2s(ges, 4)}")
  )

# MARGINAL MEANS

# Outcome ownership main effect
mm.own.maj <- d.maj %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.own.self.maj <- d.maj %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.own.other.maj <- d.maj %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.own.self.maj <- d.maj %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(subject_id, rated_gets_outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, rated_gets_outcome, paired = T)
tt.own.other.maj <- d.maj %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(subject_id, rated_gets_outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, rated_gets_outcome, paired = T)

mm.own.maj; mm.own.self.maj; tt.own.self.maj; mm.own.other.maj; tt.own.other.maj

# Outcome valence main effect
mm.out.maj <- d.maj %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.out.self.maj <- d.maj %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.out.other.maj <- d.maj %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.out.self.maj <- d.maj %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(subject_id, outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, outcome, paired = T)
tt.out.other.maj <- d.maj %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(subject_id, outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, outcome, paired = T)

mm.out.maj; mm.out.self.maj; tt.out.self.maj; mm.out.other.maj; tt.out.other.maj

# Outcome valence x Outcome ownership
mm.oo.maj <- d.maj %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.oo.self.maj <- d.maj %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.oo.other.maj <- d.maj %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.oo.self.maj <- d.maj %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>%
  tt(diff, rated_gets_outcome, paired = T)
tt.oo.other.maj <- d.maj %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>%
  tt(diff, rated_gets_outcome, paired = T)
  
mm.oo.maj; mm.oo.self.maj; tt.oo.self.maj; mm.oo.other.maj; tt.oo.other.maj

# Outcome valence x Outcome ownership x Self
mm.3w.maj <- d.maj %>%
  group_by(is_participant, outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "keep") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  summarise(diff = `Reward` - `No reward`, .groups = "drop_last") %>%
  pivot_wider(names_from = rated_gets_outcome, values_from = diff) %>%
  summarise(diff = ratedGetsOutcome - otherGetsOutcome, .groups = "drop") %>%
  group_by(is_participant) %>%
  summarise(m = mean(diff), sd = sd(diff)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))


# Main effect of Self
mm.self.maj <- d.maj %>%
  group_by(is_participant, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

```


```{r anova and marginal means minority}

d.min <- d.long %>% filter(status == "Participant in minority")

suppressWarnings({
  a.min <- ezANOVA(
    data = d.min,
    dv = responsibility_rating,
    wid = subject_id,
    within = c(
      outcome,
      rated_gets_outcome,
      is_participant
    ),
    type = 3
  )
})

a.min <- a.min$ANOVA %>% 
  mutate(
    str = glue("_F_({DFn}/{DFd}) {n2s(F, 2)}, _p_ {n2s(p)}, _ges_ {n2s(ges, 4)}")
  )

# MARGINAL MEANS

# Outcome ownership main effect
mm.own.min <- d.min %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.own.self.min <- d.min %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.own.other.min <- d.min %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.own.self.min <- d.min %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(subject_id, rated_gets_outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, rated_gets_outcome, paired = T)
tt.own.other.min <- d.min %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(subject_id, rated_gets_outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, rated_gets_outcome, paired = T)

mm.own.min; mm.own.self.min; tt.own.self.min; mm.own.other.min; tt.own.other.min

# Outcome valence main effect
mm.out.min <- d.min %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.out.self.min <- d.min %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.out.other.min <- d.min %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.out.self.min <- d.min %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(subject_id, outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, outcome, paired = T)
tt.out.other.min <- d.min %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(subject_id, outcome) %>% 
  summarise(r = mean(responsibility_rating), .groups = "drop") %>%
  tt(r, outcome, paired = T)

mm.out.min; mm.out.self.min; tt.out.self.min; mm.out.other.min; tt.out.other.min

# Outcome valence x Outcome ownership
mm.oo.min <- d.min %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.oo.self.min <- d.min %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

mm.oo.other.min <- d.min %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>% 
  summarise(m = mean(diff), sd = sd(diff), .groups = "drop_last") %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

tt.oo.self.min <- d.min %>%
  filter(is_participant == "ratingForParticipant") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>%
  tt(diff, rated_gets_outcome, paired = T)
tt.oo.other.min <- d.min %>%
  filter(is_participant == "ratingForOther") %>%
  group_by(outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  mutate(diff = `Reward` - `No reward`) %>%
  tt(diff, rated_gets_outcome, paired = T)
  
mm.oo.min; mm.oo.self.min; tt.oo.self.min; mm.oo.other.min; tt.oo.other.min

# Outcome valence x Outcome ownership x Self
mm.3w.min <- d.min %>%
  group_by(is_participant, outcome, rated_gets_outcome, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "keep") %>%
  pivot_wider(names_from = outcome, values_from = r) %>%
  summarise(diff = `Reward` - `No reward`, .groups = "drop_last") %>%
  pivot_wider(names_from = rated_gets_outcome, values_from = diff) %>%
  summarise(diff = ratedGetsOutcome - otherGetsOutcome, .groups = "drop") %>%
  group_by(is_participant) %>%
  summarise(m = mean(diff), sd = sd(diff)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))


# Main effect of Self
mm.self.min <- d.min %>%
  group_by(is_participant, subject_id) %>%
  summarise(r = mean(responsibility_rating), .groups = "drop_last") %>%
  summarise(m = mean(r), sd = sd(r)) %>%
  mutate(across(where(is.numeric), ~ round(., 2)))

```

The group decision was determined by a simple majority among three votes. 
The participant could thus be in the majority (i.e. endorsing the group decision) or minority (i.e. opposing the group decision).
A 2x2x2x2 ANOVA, adding participant Majority/Minority status to the previous analysis, indicated that all interactions with status were significant with the exception of the three-way interaction between outcome ownership, Self/Other rating, and Majority/Minority status.
Below, we explore particularly those interactions that we had identified a priori as being of particular interest. 
Researchers with different interests are welcome to explore the data to their own satisfaction.

We expected and observed a main effect of ownership where responsibility ratings were higher for the outcome owner.
We observed this effect both when participants were in the Majority 
(`r a.maj$str[2]`; Mean responsibility _without_ outcome = `r mm.own.maj$m[1]` (`r mm.own.maj$sd[1]`); Mean responsibility _with_ outcome = `r mm.own.maj$m[2]` (`r mm.own.maj$sd[2]`)), and when they were in the Minority (`r a.min$str[2]`; Mean responsibility _without_ outcome = `r mm.own.min$m[1]` (`r mm.own.min$sd[1]`); Mean responsibility _with_ outcome = `r mm.own.min$m[2]` (`r mm.own.min$sd[2]`)).
These effects were different, in that the 2x2x2x2 ANOVA interaction was significant (`r a.4way$str[9]`).

We also saw that valence bias, where responsibility ratings were higher on trials where the outcome was a reward compared to no reward, was present for both Majority (Main effect of outcome valence: `r a.maj$str[1]`; Mean responsibility for _no reward_ outcome = `r mm.out.maj$m[2]` (`r mm.out.maj$sd[2]`); Mean responsibility for _reward_ outcome = `r mm.out.maj$m[1]` (`r mm.out.maj$sd[1]`)) and Minority (Main effect of outcome valence: `r a.min$str[1]`; Mean responsibility for _no reward_ outcome = `r mm.out.min$m[2]` (`r mm.out.min$sd[2]`); Mean responsibility for _reward_ outcome = `r mm.out.min$m[1]` (`r mm.out.min$sd[1]`)) trials.
The interaction of status and outcome valence showed these effects were significantly different (`r a.4way$str[8]`).

We saw, as expected, that valence bias was stronger when the rated person is the outcome owner.
We observed this predicted outcome valence x ownership interaction both when participants were in the Majority (`r a.maj$str[4]`; Mean reward benefit _without_ outcome = `r mm.oo.maj$m[1]` (`r mm.oo.maj$sd[1]`); Mean reward benefit _with_ outcome = `r mm.oo.maj$m[2]` (`r mm.oo.maj$sd[2]`)) and Minority (`r a.min$str[4]`; Mean reward benefit _without_ outcome = `r mm.oo.min$m[1]` (`r mm.oo.min$sd[1]`); Mean reward benefit _with_ outcome = `r mm.oo.min$m[2]` (`r mm.oo.min$sd[2]`)).
The three-way interaction between outcome valence, ownership, and status was significant, indicating that this effect differed by status (`r a.4way$str[12]`).

Finally, we saw that the difference in reward benefit from receiving the reward was larger for Self ratings than Other ratings.
This effect was present but very small when participants were in the Majority (`r a.maj$str[7]`; Mean receive reward benefit for Self = `r mm.3w.maj$m[2]` (`r mm.3w.maj$sd[2]`); Mean receive reward benefit for Other = `r mm.3w.maj$m[1]` (`r mm.3w.maj$sd[1]`)), whereas it was substantially more pronounced when participants were in the Minority (`r a.min$str[7]`; Mean receive reward benefit for Self = `r mm.3w.min$m[2]` (`r mm.3w.min$sd[2]`); Mean receive reward benefit for Other = `r mm.3w.min$m[1]` (`r mm.3w.min$sd[1]`)).
These effects were significantly different (`r a.4way$str[15]`).
 